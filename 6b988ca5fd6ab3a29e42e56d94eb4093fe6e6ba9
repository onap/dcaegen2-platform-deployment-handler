{
  "comments": [
    {
      "key": {
        "uuid": "197c64c1_97085b21",
        "filename": "lib/config.js",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 511
      },
      "writtenOn": "2019-03-04T17:58:51Z",
      "side": 1,
      "message": "The code has many instances of \"if (useConsul \u003d\u003d\u003d false)\" scattered through it.   It will be clearer and easier to maintain if you:\n(a) Keep the original getConfig() and getService() functions, designed to be used with Consul, renaming them to getConfigWithConsul() and getServiceWithConsul(), or something like that.\n(b) Create two new functions, one to get configuration information without Consul and one to get Service information without Consul.\n(c) Select which version of each function to use based on the setting of the USE_CONSUL environment variable.  \n(For instance, const getConfig \u003d (process.env.USE_CONSUL \u003d\u003d\u003d \"FALSE\") ? getConfigWithoutConsul : getConfigWithConsul.  Or use an object with \"TRUE\" and \"FALSE\" as keys.)",
      "revId": "6b988ca5fd6ab3a29e42e56d94eb4093fe6e6ba9",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d2da7818_4d33fb60",
        "filename": "lib/config.js",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 4015
      },
      "writtenOn": "2019-03-04T23:11:44Z",
      "side": 1,
      "message": "I don\u0027t think this change is really needed since we\u0027d be going also from 2 functions to 4 functions and don\u0027t think we can centralize all useConsul variations in one place - this config is done only once at startup as of now. The way it\u0027s now (w/ 2 functions) doesn\u0027t really add any additional complexity and it\u0027s not duplication code; However, there is also merit in using 4 functions so I\u0027ll make the change to use new functions as suggested.",
      "parentUuid": "197c64c1_97085b21",
      "revId": "6b988ca5fd6ab3a29e42e56d94eb4093fe6e6ba9",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e766cfed_03117dac",
        "filename": "lib/config.js",
        "patchSetId": 5
      },
      "lineNbr": 127,
      "author": {
        "id": 511
      },
      "writtenOn": "2019-03-04T17:58:51Z",
      "side": 1,
      "message": "The service information for Cloudify Manager is treated differently from Inventory.  I suggest just augmenting the existing set of environment variables.\nWe already have CLOUDIFY_PROTOCOL and INVENTORY_PROTOCOL.  I suggest adding CLOUDIFY_HOST, CLOUDIFY_PORT, INVENTORY_HOST, and INVENTORY_PORT.  I also suggest adding the corresponding elements to the JSON structure (cloudify.host, cloudify.port, inventory.host, inventory.port).  The normal case is for deployment handler to run in a Kubernetes, in the same cluster as Cloudify Manager and inventory, so we can also have useful defaults.  (CLOUDIFY_HOST: \"cloudify-manager\", CLOUDIFY_PORT: 443 (to correspond with the default protocol, https), INVENTORY_HOST: \"inventory\", INVENTORY_PORT: 8080) \nThis can all be documented in the table in the comment at the start of the file.",
      "revId": "6b988ca5fd6ab3a29e42e56d94eb4093fe6e6ba9",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1f1782d1_54678c27",
        "filename": "lib/config.js",
        "patchSetId": 5
      },
      "lineNbr": 127,
      "author": {
        "id": 4015
      },
      "writtenOn": "2019-03-04T23:11:44Z",
      "side": 1,
      "message": "I don\u0027t know if we should be adding these 4 env variables; I\u0027d rather keep it the way it is now. It\u0027s you know pretty clear how these host/port values are coming from. \nPerhaps later if we need more use of these settings, we can add them as new env. variables.",
      "parentUuid": "e766cfed_03117dac",
      "revId": "6b988ca5fd6ab3a29e42e56d94eb4093fe6e6ba9",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5201795e_f48c3972",
        "filename": "lib/config.js",
        "patchSetId": 5
      },
      "lineNbr": 127,
      "author": {
        "id": 511
      },
      "writtenOn": "2019-03-06T14:57:34Z",
      "side": 1,
      "message": "You\u0027ve introduced a number of new variables that aren\u0027t documented and that don\u0027t treat Cloudify and inventory in a consistent way.  \n\nSomeone is going to have to create the Helm chart that sets up the environment variables for a no-Consul deployment, and I don\u0027t see a good reason for having inconsistencies between Cloudify and inventory and inconsistencies between how we handle basic configuration information and how we handle the addressing information for Cloudify and inventory.\n\nI am suggesting that we get rid of your new variables and go from this:\n * --------------------------------------------------------------------------------------\n * | cloudify.user         | CLOUDIFY_USER          | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | cloudify.password     | CLOUDIFY_PASSWORD      | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | cloudify.protocol     | CLOUDIFY_PROTOCOL      | No        | \"https\"               |\n * --------------------------------------------------------------------------------------\n * | inventory.user        | INVENTORY_USER         | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | inventory.password    | INVENTORY_PASSWORD     | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | inventory.protocol    | INVENTORY_PROTOCOL     | No        | \"https\"               |\n\nto this:\n * --------------------------------------------------------------------------------------\n * | cloudify.user         | CLOUDIFY_USER          | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | cloudify.password     | CLOUDIFY_PASSWORD      | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | cloudify.protocol     | CLOUDIFY_PROTOCOL      | No        | \"https\"               |\n * --------------------------------------------------------------------------------------\n * | cloudify.host         | CLOUDIFY_HOST          | If not using Consul| \"cloudify-manager\"|\n * -------------------------------------------------------------------------------------------\n * | cloudify.port         | CLOUDIFY_PORT          | No        | None                  |\n * --------------------------------------------------------------------------------------\n * | inventory.user        | INVENTORY_USER         | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | inventory.password    | INVENTORY_PASSWORD     | No        | none                  |\n * --------------------------------------------------------------------------------------\n * | inventory.protocol    | INVENTORY_PROTOCOL     | No        | \"https\"               |\n * --------------------------------------------------------------------------------------\n * | inventory.host        | INVENTORY_HOST         | If not using Consul| \"inventory\"  |\n * -------------------------------------------------------------------------------------|\n * | inventory.port        | CLOUDIFY_PORT          | No        | 8080                  |\n * --------------------------------------------------------------------------------------",
      "parentUuid": "1f1782d1_54678c27",
      "revId": "6b988ca5fd6ab3a29e42e56d94eb4093fe6e6ba9",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6958fb83_5e823843",
        "filename": "lib/config.js",
        "patchSetId": 5
      },
      "lineNbr": 127,
      "author": {
        "id": 4015
      },
      "writtenOn": "2019-03-06T15:46:52Z",
      "side": 1,
      "message": "I don\u0027t know if inventory and cloudify treatment should be consistent - for example, inventory has no user and password but cloudify does among other reasons below.\n\nAlso, on k8s, the platform makes available an env. variable: INVENTORY_SERVICE_SERVICE_PORT that I have to use to get inventory port.\nSo there are differences in how they\u0027re treated.\n\nUsing the inventory env variable names that I have also corresponds with their application; i.e. using INVENTORY_SERVICE_NAME refers to the inventory service name and should be self explanatory. \nGetting inventory \"host\" on k8s consists of 3 parts: INVENTORY_SERVICE_NAME + INVENTORY_SERVICE_NAME_SUFFIX + INVENTORY_SERVICE_SERVICE_PORT (along with NAMESPACE) so we can\u0027t just use a single env var like: INVENTORY_HOST.\n\nAlso, for cloudify, I\u0027m using same existing format we\u0027re using today (using consul) so that someone can just pass the existing consul config via the CLOUDIFY env. variable, this way we follow same format.\n\nAs for documenting the table; yes I can do that once we agree on path forward.",
      "parentUuid": "5201795e_f48c3972",
      "revId": "6b988ca5fd6ab3a29e42e56d94eb4093fe6e6ba9",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30ae19c0_42199f4c",
        "filename": "lib/config.js",
        "patchSetId": 5
      },
      "lineNbr": 127,
      "author": {
        "id": 511
      },
      "writtenOn": "2019-03-22T11:54:23Z",
      "side": 1,
      "message": "k8s makes similar variables available for Cloudify Manager port and address.  (In ONAP, CM runs in k8s.) There really isn\u0027t a difference.\n\nThe CLOUDIFY variable that you\u0027re proposing overlaps with existing variables that convey the same information.  \n\nSince there is already a solution for providing DH configuration in Consul for the Dublin release, maybe the best way forward is to drop the \"useConsul\" changes for now and revisit it later.",
      "parentUuid": "6958fb83_5e823843",
      "revId": "6b988ca5fd6ab3a29e42e56d94eb4093fe6e6ba9",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    }
  ]
}